[phases.setup]
aptPkgs = [
    "python3",
    "python-is-python3",
    # Playwright dependencies
    "libnss3",
    "libatk1.0-0",
    "libatk-bridge2.0-0",
    "libcups2",
    "libdrm2",
    "libgbm1",
    "libasound2",
    "libpangocairo-1.0-0",
    "libxss1",
    "libxshmfence1",
    "libglu1"
]

[variables]
NODE_VERSION = "23.3.0"
PNPM_VERSION = "9.14.4"
YOUTUBE_DL_SKIP_PYTHON_CHECK = "1"
# Skip Playwright browser installation
PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD = "1"
PORT = "3001"  # Use a different port than 3000

[phases.install]
cmds = [
    # Install Node.js
    "curl -fsSL https://nodejs.org/dist/v23.3.0/node-v23.3.0-linux-x64.tar.xz -o /tmp/node.tar.xz",
    "tar -xf /tmp/node.tar.xz -C /tmp",
    "cp -r /tmp/node-v23.3.0-linux-x64/* /usr/local",
    "node --version",
    # Install PNPM
    "npm install -g pnpm@9.14.4",
    "pnpm --version",
    # Install dependencies without Playwright
    "PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1 pnpm install --frozen-lockfile --ignore-scripts"
]

[phases.build]
cmds = ["pnpm run build"]

[start]
cmd = "pnpm start"